name: Notion Database Backup

on:
  schedule:
    - cron: '0 0 * * *' # 毎日日本時間の午前9時に自動実行
  workflow_dispatch: # ボタン一つで手動実行できるようにする設定

jobs:
  backup:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Fetch Notion Data
        run: |
          curl -X POST "https://api.notion.com/v1/databases/${{ secrets.NOTION_DATABASE_ID }}/query" \
            -H "Authorization: Bearer ${{ secrets.NOTION_TOKEN }}" \
            -H "Notion-Version: 2022-06-28" \
            -H "Content-Type: application/json" \
            --data '{}' > cd_backup.json

      - name: Commit and Push
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add cd_backup.json
          git commit -m "chore: update notion backup [$(date +'%Y-%m-%d %H:%M:%S')]" || exit 0
          git push
